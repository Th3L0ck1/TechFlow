name: CI Pipeline - Sistema de Tarefas

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    name: Executar Testes do Sistema
    
    steps:
    - name: Checkout do código
      uses: actions/checkout@v4
      
    - name: Configurar Node.js (apenas para executar JavaScript)
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        # REMOVEMOS o cache: npm que estava causando o erro
      
    - name: Executar testes automatizados
      run: |
        echo "🚀 Iniciando testes do sistema de tarefas..."
        node tests/test.js
        echo "✅ Testes executados com sucesso!"
        
    - name: Validar estrutura do projeto
      run: |
        echo "🔍 Verificando arquivos do projeto..."
        echo "📁 Estrutura de arquivos:"
        ls -la
        echo "📁 Conteúdo da pasta src:"
        ls -la src/
        echo "📁 Conteúdo da pasta tests:"
        ls -la tests/
        
        # Validação dos arquivos essenciais
        if [ -f "src/index.html" ]; then
          echo "✅ Arquivo HTML encontrado"
        else
          echo "❌ ERRO: Arquivo HTML não encontrado"
          exit 1
        fi
        
        if [ -f "src/script.js" ]; then
          echo "✅ Arquivo JavaScript encontrado"
        else
          echo "❌ ERRO: Arquivo JavaScript não encontrado"
          exit 1
        fi
        
        if [ -f "tests/test.js" ]; then
          echo "✅ Arquivo de testes encontrado"
        else
          echo "❌ ERRO: Arquivo de testes não encontrado"
          exit 1
        fi
        
        echo "🎉 Estrutura do projeto validada com sucesso!"